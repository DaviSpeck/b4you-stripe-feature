/award-shipments:
  get:
    tags:
      - Awards
    summary: Listar premiações
    description: Retorna uma lista paginada de premiações com informações do produtor e total de comissões
    parameters:
      - name: producer_id
        in: query
        description: Filtrar por ID do produtor
        required: false
        schema:
          type: integer
        example: 123
      - name: producer_uuid
        in: query
        description: Filtrar por UUID do produtor
        required: false
        schema:
          type: string
          format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
      - name: milestone
        in: query
        description: Filtrar por marco de vendas
        required: false
        schema:
          type: string
          enum:
            - 10K
            - 50K
            - 500K
            - 1M
            - 5M
            - 10M
        example: 10K
      - name: status
        in: query
        description: Filtrar por status
        required: false
        schema:
          type: string
          enum:
            - pending
            - sent
        example: pending
      - name: input
        in: query
        description: Busca por nome, email ou WhatsApp do produtor
        required: false
        schema:
          type: string
        example: João Silva
      - name: start_date
        in: query
        description: Data inicial para filtro (formato YYYY-MM-DD)
        required: false
        schema:
          type: string
          format: date
        example: '2025-01-01'
      - name: end_date
        in: query
        description: Data final para filtro (formato YYYY-MM-DD)
        required: false
        schema:
          type: string
          format: date
        example: '2025-01-31'
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 20
          minimum: 1
          maximum: 100
        example: 20
    responses:
      '200':
        description: Lista de premiações obtida com sucesso
        content:
          application/json:
            schema:
              $ref: ./modulos\awards/schemas.yaml#/components/schemas/PagedAwardShipmentsResponse
            example:
              count: 25
              rows:
                - id: 1
                  producer_id: 123
                  milestone: 10K
                  status: pending
                  tracking_code: null
                  tracking_link: null
                  achieved_date: '2025-01-15T10:30:00Z'
                  sent_date: null
                  created_at: '2025-01-15T10:30:00Z'
                  updated_at: '2025-01-15T10:30:00Z'
                  producer:
                    id: 123
                    uuid: 550e8400-e29b-41d4-a716-446655440000
                    full_name: João Silva
                    email: joao@email.com
                    phone: '5511999998888'
                  user_total_comission: 15000.5
      '400':
        $ref: ./components/common-responses.yaml#/components/responses/BadRequest
      '401':
        $ref: ./components/common-responses.yaml#/components/responses/UnauthorizedError
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
  post:
    tags:
      - Awards
    summary: Criar nova premiação
    description: >-
      Cria uma nova premiação para um produtor. Pelo menos um identificador do produtor é obrigatório (producer_id,
      producer_uuid ou producer_email)
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ./modulos\awards/schemas.yaml#/components/schemas/CreateAwardShipmentRequest
          examples:
            com_producer_id:
              summary: Criar com ID do produtor
              value:
                producer_id: 123
                milestone: 10K
                achieved_date: '2025-01-15T10:30:00Z'
                status: pending
            com_producer_uuid:
              summary: Criar com UUID do produtor
              value:
                producer_uuid: 550e8400-e29b-41d4-a716-446655440000
                milestone: 50K
                achieved_date: '2025-01-15T10:30:00Z'
            com_producer_email:
              summary: Criar com email do produtor
              value:
                producer_email: joao@email.com
                milestone: 100K
                achieved_date: '2025-01-15T10:30:00Z'
    responses:
      '201':
        description: Premiação criada com sucesso
        content:
          application/json:
            schema:
              $ref: ./modulos\awards/schemas.yaml#/components/schemas/AwardShipment
            example:
              id: 1
              producer_id: 123
              milestone: 10K
              status: pending
              tracking_code: null
              tracking_link: null
              achieved_date: '2025-01-15T10:30:00Z'
              sent_date: null
              created_at: '2025-01-15T10:30:00Z'
              updated_at: '2025-01-15T10:30:00Z'
      '400':
        description: Dados inválidos ou identificador do produtor não fornecido
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: ValidationError
              message: UUID ou email do produtor é obrigatório
      '401':
        $ref: ./components/common-responses.yaml#/components/responses/UnauthorizedError
      '404':
        description: Produtor não encontrado
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: NotFoundError
              message: Produtor não encontrado para o UUID informado
      '409':
        description: Premiação já existe para este produtor e milestone
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: ConflictError
              message: Registro já existe para este produtor e milestone
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/award-shipments/{id}:
  patch:
    tags:
      - Awards
    summary: Atualizar premiação
    description: Atualiza os dados de uma premiação existente
    parameters:
      - name: id
        in: path
        required: true
        description: ID da premiação
        schema:
          type: integer
        example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ./modulos\awards/schemas.yaml#/components/schemas/UpdateAwardShipmentRequest
          example:
            milestone: 50K
            status: sent
            tracking_code: BR123456789BR
            tracking_link: https://www.correios.com.br/rastreamento
    responses:
      '200':
        description: Premiação atualizada com sucesso
        content:
          application/json:
            schema:
              $ref: ./modulos\awards/schemas.yaml#/components/schemas/AwardShipment
      '400':
        $ref: ./components/common-responses.yaml#/components/responses/BadRequest
      '401':
        $ref: ./components/common-responses.yaml#/components/responses/UnauthorizedError
      '404':
        description: Premiação não encontrada
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: NotFoundError
              message: Registro não encontrado
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
  delete:
    tags:
      - Awards
    summary: Deletar premiação
    description: Remove uma premiação do sistema
    parameters:
      - name: id
        in: path
        required: true
        description: ID da premiação
        schema:
          type: integer
        example: 1
    responses:
      '200':
        description: Premiação deletada com sucesso
        content:
          application/json:
            schema:
              $ref: ./modulos\awards/schemas.yaml#/components/schemas/DeleteResponse
            example:
              success: true
      '400':
        $ref: ./components/common-responses.yaml#/components/responses/BadRequest
      '401':
        $ref: ./components/common-responses.yaml#/components/responses/UnauthorizedError
      '404':
        description: Premiação não encontrada
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: NotFoundError
              message: Registro não encontrado
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/award-shipments/{id}/confirm:
  patch:
    tags:
      - Awards
    summary: Confirmar envio da premiação
    description: >-
      Confirma o envio de uma premiação, atualizando o status para 'sent' e dados de rastreamento. Automaticamente
      define a data de envio como atual se não fornecida.
    parameters:
      - name: id
        in: path
        required: true
        description: ID da premiação
        schema:
          type: integer
        example: 1
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: ./modulos\awards/schemas.yaml#/components/schemas/ConfirmAwardShipmentRequest
          example:
            tracking_code: BR123456789BR
            tracking_link: https://www.correios.com.br/rastreamento
            sent_date: '2025-01-15T10:30:00Z'
    responses:
      '200':
        description: Envio confirmado com sucesso
        content:
          application/json:
            schema:
              $ref: ./modulos\awards/schemas.yaml#/components/schemas/AwardShipment
      '400':
        $ref: ./components/common-responses.yaml#/components/responses/BadRequest
      '401':
        $ref: ./components/common-responses.yaml#/components/responses/UnauthorizedError
      '404':
        description: Premiação não encontrada
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
            example:
              error: NotFoundError
              message: Registro não encontrado
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/market:
  get:
    tags:
      - Market
    summary: Lista produtos pendentes de aprovação
    description: Retorna uma lista paginada de produtos que estão pendentes de aprovação para aparecer na vitrine do market
    parameters:
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
      - name: input
        in: query
        description: Busca por nome do produto ou nome do usuário produtor
        required: false
        schema:
          type: string
        example: curso de javascript
      - name: start_date
        in: query
        description: Data inicial para filtro (formato YYYY-MM-DD)
        required: false
        schema:
          type: string
          format: date
        example: '2024-01-01'
      - name: end_date
        in: query
        description: Data final para filtro (formato YYYY-MM-DD)
        required: false
        schema:
          type: string
          format: date
        example: '2024-12-31'
    responses:
      '200':
        description: Lista de produtos pendentes de aprovação
        content:
          application/json:
            schema:
              $ref: ./modulos\market/schemas.yaml#/components/schemas/PagedMarketPending
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/active:
  get:
    tags:
      - Métricas Comerciais
    summary: Total de produtos ativos
    description: Retorna o número de produtos com ao menos uma venda nos últimos X dias
    parameters:
      - name: days
        in: query
        description: 'Número de dias da janela (ex.: 7, 15, 30). Default: 30'
        required: false
        schema:
          type: integer
          default: 30
          minimum: 1
        example: 30
    responses:
      '200':
        description: Objeto com totalActive
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/TotalActive
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/new:
  get:
    tags:
      - Métricas Comerciais
    summary: Novos produtos por dia
    description: Retorna quantos produtos foram criados em cada dia dos últimos X dias
    parameters:
      - name: days
        in: query
        description: 'Número de dias da janela (ex.: 7, 15, 30). Default: 30'
        required: false
        schema:
          type: integer
          default: 30
          minimum: 1
        example: 30
    responses:
      '200':
        description: Lista com data e quantidade de novos produtos
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/DailyNewProducts
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/ranking:
  get:
    tags:
      - Métricas Comerciais
    summary: Ranking de produtos por vendas
    description: Retorna página X do ranking de produtos com, no mínimo, *threshold* vendas ou receita
    parameters:
      - name: threshold
        in: query
        description: 'Filtro mínimo de vendas/receita (default: 0)'
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 10
      - name: startDate
        in: query
        description: Data inicial para filtro de vendas (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-01 00:00:00'
      - name: endDate
        in: query
        description: Data final para filtro de vendas (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-31 23:59:59'
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
    responses:
      '200':
        description: Objeto com total de itens e lista de produtos
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/ProductRanking
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/producers/paused:
  get:
    tags:
      - Análise de Produtores
    summary: PRM – Produtores que pararam neste período
    description: >
      Lista paginada de produtores que venderam no período anterior mas não no período atual.


      - Por padrão, compara **mês anterior × mês atual** (`period=month`) ou **janelas de X dias** (`period=days`,
      `days=30`).

      - Para mais controle, envie as datas customizadas (`prevStart`, `prevEnd`, `currStart`, `currEnd`) no formato
      `YYYY-MM-DD HH:mm:ss`.


      > **Nota:** Parâmetros de data customizados sobrescrevem `period`/`days`.
    parameters:
      - name: period
        in: query
        description: |
          Tipo de comparação de períodos  
            • **month** – mês anterior × atual  
            • **days** – usa janela de dias (default)
        required: false
        schema:
          type: string
          enum:
            - month
            - days
          default: days
        example: days
      - name: days
        in: query
        description: 'Número de dias da janela (ex.: 7, 15, 30). Default: 30'
        required: false
        schema:
          type: integer
          default: 30
          minimum: 1
        example: 30
      - name: prevStart
        in: query
        description: Data inicial do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-01 00:00:00'
      - name: prevEnd
        in: query
        description: Data final do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-31 23:59:59'
      - name: currStart
        in: query
        description: Data inicial do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-01 00:00:00'
      - name: currEnd
        in: query
        description: Data final do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-28 23:59:59'
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
    responses:
      '200':
        description: Lista paginada de produtores que venderam antes mas não agora
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/PagedProducerBasic
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/producers/comparative:
  get:
    tags:
      - Análise de Produtores
    summary: PD10K – Comparativo mês-a-mês dos top produtores
    description: >
      Lista paginada do comparativo de receita entre dois períodos consecutivos, filtrando por receita mínima
      (`threshold`).


      - Envie datas customizadas usando `prevStart`, `prevEnd`, `currStart`, `currEnd` (formato `YYYY-MM-DD HH:mm:ss`).

      - Caso não informe, será assumido mês a mês anterior × atual.
    parameters:
      - name: threshold
        in: query
        description: 'Filtro mínimo de vendas/receita (default: 0)'
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 10000
      - name: prevStart
        in: query
        description: Data inicial do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-01 00:00:00'
      - name: prevEnd
        in: query
        description: Data final do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-31 23:59:59'
      - name: currStart
        in: query
        description: Data inicial do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-01 00:00:00'
      - name: currEnd
        in: query
        description: Data final do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-28 23:59:59'
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
    responses:
      '200':
        description: Receitas mês anterior × mês atual por produtor (paginado)
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/PagedProducerComparative
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/producers/intervals:
  get:
    tags:
      - Análise de Produtores
    summary: PIN90/60/30 – Produtores ativos nas últimas 3 janelas
    description: >
      Retorna a quantidade de produtores ativos (com pelo menos 1 venda) nas janelas de 30, 60 e 90 dias anteriores à
      data de hoje.
    responses:
      '200':
        description: Quantidade de produtores ativos nas janelas de 30 / 60 / 90 dias
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/ProducerIntervals
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/metrics/producers/performance-drop:
  get:
    tags:
      - Análise de Produtores
    summary: PP5D – Alerta de queda de performance
    description: |
      Lista paginada de produtores que tiveram queda de performance entre dois períodos consecutivos de vendas.
      - O percentual mínimo da queda é definido pelo parâmetro `dropPct`.
      - Parâmetros de período aceitos:
        - `days` (por padrão, compara os últimos X dias com os X dias imediatamente anteriores)
        - Ou datas customizadas: `prevStart`, `prevEnd`, `currStart`, `currEnd` (formato `YYYY-MM-DD HH:mm:ss`)
    parameters:
      - name: days
        in: query
        description: 'Número de dias da janela (ex.: 7, 15, 30). Default: 30'
        required: false
        schema:
          type: integer
          default: 30
          minimum: 1
        example: 30
      - name: dropPct
        in: query
        description: 'Percentual mínimo de queda de performance (default: 50)'
        required: false
        schema:
          type: number
          format: double
          default: 50
          minimum: 0
          maximum: 100
        example: 50
      - name: prevStart
        in: query
        description: Data inicial do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-01 00:00:00'
      - name: prevEnd
        in: query
        description: Data final do período anterior (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-01-31 23:59:59'
      - name: currStart
        in: query
        description: Data inicial do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-01 00:00:00'
      - name: currEnd
        in: query
        description: Data final do período atual (YYYY-MM-DD HH:mm:ss)
        required: false
        schema:
          type: string
          format: date-time
        example: '2025-02-28 23:59:59'
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
    responses:
      '200':
        description: Produtores com queda ≥ *dropPct* entre períodos (paginado)
        content:
          application/json:
            schema:
              $ref: ./modulos\metrics/schemas.yaml#/components/schemas/PagedProducerPerformanceDrop
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/users/reactivation/producers:
  get:
    tags:
      - Reativação de Produtores
    summary: Lista produtores para reativação
    description: Retorna uma lista paginada de produtores que podem ser candidatos para reativação
    parameters:
      - name: page
        in: query
        description: Índice da página (0-based)
        required: false
        schema:
          type: integer
          default: 0
          minimum: 0
        example: 0
      - name: size
        in: query
        description: Quantidade de itens por página
        required: false
        schema:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
        example: 10
      - name: status
        in: query
        description: Filtra por status de reativação
        required: false
        schema:
          type: string
          enum:
            - not_contacted
            - contacting
            - success
        example: not_contacted
      - name: name
        in: query
        description: Filtra por parte do nome
        required: false
        schema:
          type: string
        example: João
      - name: email
        in: query
        description: Filtra por parte do e-mail
        required: false
        schema:
          type: string
        example: joao@email.com
    responses:
      '200':
        description: Lista paginada de produtores
        content:
          application/json:
            schema:
              $ref: ./modulos\users/schemas.yaml#/components/schemas/PagedReactivationProducer
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/users/reactivation/producers/{userUuid}:
  patch:
    tags:
      - Reativação de Produtores
    summary: Atualiza manualmente o status de reativação
    description: Permite atualizar manualmente o status de reativação de um produtor específico
    parameters:
      - name: userUuid
        in: path
        required: true
        description: UUID do usuário/produtor
        schema:
          type: string
          format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      description: Novo status de reativação
      required: true
      content:
        application/json:
          schema:
            $ref: ./modulos\users/schemas.yaml#/components/schemas/UpdateReactivationStatus
    responses:
      '204':
        description: Status atualizado com sucesso (nenhum conteúdo)
      '400':
        description: Status inválido ou não permitido
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
      '404':
        description: Produtor não encontrado
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/users/reactivation/producers/reset:
  post:
    tags:
      - Reativação de Produtores
    summary: Reset mensal de todos os status
    description: Executa o reset mensal de todos os status de reativação e atribui novos produtores para reativação
    responses:
      '204':
        description: Reset e atribuição concluídos
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/users/reactivation/producers/report:
  get:
    tags:
      - Reativação de Produtores
    summary: Gera relatório .xlsx do mês anterior
    description: Gera e retorna um relatório em formato Excel (.xlsx) com dados de reativação do mês anterior
    responses:
      '200':
        description: Arquivo XLSX para download
        content:
          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
            schema:
              type: string
              format: binary
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
/users/{userUuid}/manager:
  put:
    tags:
      - Usuários
    summary: Atualiza o gerente do usuário
    description: Atualiza o campo de gerente associado a um usuário específico
    parameters:
      - name: userUuid
        in: path
        required: true
        description: UUID do usuário
        schema:
          type: string
          format: uuid
        example: 550e8400-e29b-41d4-a716-446655440000
    requestBody:
      description: Dados do gerente a ser associado
      required: true
      content:
        application/json:
          schema:
            $ref: ./modulos/users/schemas.yaml#/components/schemas/UpdateManager
    responses:
      '200':
        description: Gerente atualizado com sucesso
      '400':
        description: Dados inválidos ou gerente não informado
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
      '404':
        description: Usuário não encontrado
        content:
          application/json:
            schema:
              $ref: ./components/common-schemas.yaml#/components/schemas/Error
      '500':
        $ref: ./components/common-responses.yaml#/components/responses/InternalServerError
